<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup Your Profile</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #333; margin-bottom: 10px; }
        .form-section { margin-bottom: 30px; padding: 20px; background: #f9f9f9; border-radius: 6px; }
        .form-section h3 { margin-top: 0; color: #007cba; border-bottom: 2px solid #007cba; padding-bottom: 10px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #555; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; box-sizing: border-box; }
        .form-group textarea { height: 80px; resize: vertical; }
        .form-group input[type="range"] { margin: 10px 0; }
        #complexity-label { font-weight: bold; color: #007cba; margin-left: 10px; }
        .form-actions { text-align: center; margin-top: 30px; }
        .form-actions button { padding: 12px 24px; margin: 0 10px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        .form-actions button[type="submit"] { background: #007cba; color: white; }
        .form-actions button[type="submit"]:hover { background: #005a8b; }
        .form-actions button[type="button"] { background: #6c757d; color: white; }
        .form-actions button[type="button"]:hover { background: #545b62; }
        .form-actions button:disabled { background: #ccc; cursor: not-allowed; }
        .loading { text-align: center; color: #007cba; font-weight: bold; }
        .status-success { color: #28a745; font-weight: bold; text-align: center; }
        .status-error { color: #dc3545; font-weight: bold; text-align: center; }
        .profile-actions { margin-top: 20px; text-align: center; }
        .profile-actions button { margin: 5px; padding: 8px 16px; border: 1px solid #ddd; background: #f8f9f9; cursor: pointer; border-radius: 4px; }
        .profile-actions button:hover { background: #e9e9e9; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Setup Your Interview Profile</h1>
        <p>Help us personalize your interview experience by telling us about yourself. Your profile is stored locally on your device.</p>

        <form id="profile-form">
            <div class="form-section">
                <h3>Basic Information</h3>
                
                <div class="form-group">
                    <label for="username">Username (optional):</label>
                    <input type="text" id="username" name="username" placeholder="Leave blank for anonymous">
                </div>

                <div class="form-group">
                    <label for="current_job_title">Current Job Title:</label>
                    <input type="text" id="current_job_title" name="current_job_title" placeholder="e.g., Software Developer">
                </div>

                <div class="form-group">
                    <label for="target_role">Target Role:</label>
                    <input type="text" id="target_role" name="target_role" placeholder="e.g., Senior Software Engineer">
                </div>
            </div>

            <div class="form-section">
                <h3>Experience & Background</h3>
                
                <div class="form-group">
                    <label for="experience_level">Experience Level:</label>
                    <select id="experience_level" name="experience_level" required>
                        <option value="">Select your level...</option>
                        <option value="entry">Entry Level (0-2 years)</option>
                        <option value="junior">Junior (2-4 years)</option>
                        <option value="mid">Mid-Level (4-7 years)</option>
                        <option value="senior">Senior (7-12 years)</option>
                        <option value="lead">Lead/Principal (12+ years)</option>
                        <option value="executive">Executive/C-Level</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="industry">Industry:</label>
                    <select id="industry" name="industry" required>
                        <option value="">Select industry...</option>
                        <option value="technology">Technology</option>
                        <option value="finance">Finance</option>
                        <option value="healthcare">Healthcare</option>
                        <option value="education">Education</option>
                        <option value="retail">Retail</option>
                        <option value="manufacturing">Manufacturing</option>
                        <option value="consulting">Consulting</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="role_type">Role Type:</label>
                    <select id="role_type" name="role_type" required>
                        <option value="">Select role type...</option>
                        <option value="technical">Technical/Engineering</option>
                        <option value="management">Management/Leadership</option>
                        <option value="sales">Sales/Business Development</option>
                        <option value="marketing">Marketing/Communications</option>
                        <option value="operations">Operations/Process</option>
                        <option value="creative">Creative/Design</option>
                        <option value="analyst">Analyst/Research</option>
                    </select>
                </div>
            </div>

            <div class="form-section">
                <h3>Learning Preferences</h3>
                
                <div class="form-group">
                    <label for="preferred_feedback_model">Feedback Style:</label>
                    <select id="preferred_feedback_model" name="preferred_feedback_model" required>
                        <option value="">Choose your preferred style...</option>
                        <option value="adaptive">Adaptive (Automatically adjusts to you)</option>
                        <option value="coaching">Coaching (Supportive and encouraging)</option>
                        <option value="peer_review">Peer Review (Collaborative and balanced)</option>
                        <option value="expert_analysis">Expert Analysis (Technical and detailed)</option>
                        <option value="strategic">Strategic (Big picture focused)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="learning_preference">Learning Style:</label>
                    <select id="learning_preference" name="learning_preference" required>
                        <option value="">Select your style...</option>
                        <option value="detailed">Detailed (I want comprehensive feedback)</option>
                        <option value="concise">Concise (Give me the key points)</option>
                        <option value="conversational">Conversational (Casual and friendly)</option>
                        <option value="data_driven">Data-Driven (Show me the metrics)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="feedback_complexity">Feedback Complexity (1-5):</label>
                    <input type="range" id="feedback_complexity" name="feedback_complexity" min="1" max="5" value="3" oninput="updateComplexityLabel(this.value)">
                    <span id="complexity-label">Medium (3)</span>
                </div>
            </div>

            <div class="form-section">
                <h3>Goals & Focus Areas</h3>
                
                <div class="form-group">
                    <label for="interview_goals">Interview Goals:</label>
                    <textarea id="interview_goals" name="interview_goals" placeholder="What do you want to achieve? (e.g., improve confidence, practice technical questions)"></textarea>
                </div>

                <div class="form-group">
                    <label for="focus_areas">Areas to Focus On (comma-separated):</label>
                    <input type="text" id="focus_areas" name="focus_areas" placeholder="e.g., leadership, technical skills, communication">
                </div>

                <div class="form-group">
                    <label for="weak_areas">Areas to Improve (comma-separated):</label>
                    <input type="text" id="weak_areas" name="weak_areas" placeholder="e.g., public speaking, handling stress, technical depth">
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" id="create-profile-btn">Create Profile & Continue</button>
                <button type="button" onclick="skipProfile()">Skip for Now</button>
            </div>
        </form>

        <div id="loading" style="display: none;" class="loading">
            <p>Creating your profile...</p>
        </div>

        <div id="profile-status"></div>

        <div class="profile-actions">
            <button onclick="exportProfile()">üì§ Export Profile</button>
            <button onclick="importProfile()">üì• Import Profile</button>
            <input type="file" id="import-file" accept=".json" style="display: none;" onchange="handleImport(event)">
        </div>
    </div>

    <script>
        // Profile Management System
        const ProfileManager = {
            save: function(profile) {
                profile.created_at = new Date().toISOString();
                profile.updated_at = new Date().toISOString();
                profile.session_count = parseInt(localStorage.getItem('session_count') || '0');
                profile.user_id = profile.user_id || 'user_' + Date.now();
                localStorage.setItem('userProfile', JSON.stringify(profile));
                localStorage.setItem('user_id', profile.user_id);
                return profile.user_id;
            },
            
            load: function() {
                const profileData = localStorage.getItem('userProfile');
                return profileData ? JSON.parse(profileData) : {};
            },
            
            exists: function() {
                return localStorage.getItem('userProfile') !== null;
            },
            
            export: function() {
                return JSON.stringify(this.load(), null, 2);
            },
            
            import: function(profileJson) {
                try {
                    const profile = JSON.parse(profileJson);
                    localStorage.setItem('userProfile', JSON.stringify(profile));
                    if (profile.user_id) {
                        localStorage.setItem('user_id', profile.user_id);
                    }
                    return true;
                } catch (e) {
                    return false;
                }
            },
            
            calculateCompletion: function(profile) {
                const fields = ['username', 'current_job_title', 'target_role', 'experience_level', 
                              'industry', 'role_type', 'preferred_feedback_model', 'learning_preference',
                              'interview_goals', 'focus_areas', 'weak_areas'];
                const completed = fields.filter(field => profile[field] && profile[field].trim()).length;
                return Math.round((completed / fields.length) * 100);
            }
        };

        function updateComplexityLabel(value) {
            const labels = {
                1: 'Very Simple (1)',
                2: 'Simple (2)', 
                3: 'Medium (3)',
                4: 'Detailed (4)',
                5: 'Very Detailed (5)'
            };
            document.getElementById('complexity-label').textContent = labels[value];
        }

        function skipProfile() {
            window.location.href = 'start.html';
        }

        function exportProfile() {
            const profile = ProfileManager.load();
            if (Object.keys(profile).length === 0) {
                alert('No profile to export. Please create a profile first.');
                return;
            }
            
            const dataStr = ProfileManager.export();
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'interview_profile.json';
            link.click();
            URL.revokeObjectURL(url);
        }

        function importProfile() {
            document.getElementById('import-file').click();
        }

        function handleImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const success = ProfileManager.import(e.target.result);
                if (success) {
                    alert('Profile imported successfully!');
                    loadExistingProfile();
                } else {
                    alert('Failed to import profile. Please check the file format.');
                }
            };
            reader.readAsText(file);
        }

        function loadExistingProfile() {
            const profile = ProfileManager.load();
            if (Object.keys(profile).length === 0) return;
            
            // Populate form fields
            Object.keys(profile).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.value = profile[key];
                    if (key === 'feedback_complexity') {
                        updateComplexityLabel(profile[key]);
                    }
                }
            });
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Check for existing profile
            if (ProfileManager.exists()) {
                loadExistingProfile();
            }
            
            // Check URL params for editing mode
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('edit') === 'true') {
                document.querySelector('h1').textContent = 'Edit Your Profile';
                document.getElementById('create-profile-btn').textContent = 'Update Profile';
            }
        });

        document.getElementById('profile-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const profile = {};
            
            // Convert form data to profile object
            for (let [key, value] of formData.entries()) {
                profile[key] = value;
            }
            
            // Calculate profile completion
            profile.profile_completion = ProfileManager.calculateCompletion(profile);
            
            const createBtn = document.getElementById('create-profile-btn');
            const loading = document.getElementById('loading');
            const status = document.getElementById('profile-status');
            
            // Show loading state
            createBtn.disabled = true;
            loading.style.display = 'block';
            status.innerHTML = '';
            
            // Simulate processing time
            setTimeout(() => {
                try {
                    const userId = ProfileManager.save(profile);
                    loading.style.display = 'none';
                    status.innerHTML = '<p class="status-success">‚úÖ Profile saved successfully!</p>';
                    
                    // Redirect to start page after brief delay
                    setTimeout(() => {
                        window.location.href = 'start.html?profile_created=true';
                    }, 1000);
                } catch (error) {
                    loading.style.display = 'none';
                    status.innerHTML = '<p class="status-error">‚ùå Error saving profile. Please try again.</p>';
                    createBtn.disabled = false;
                    console.error('Profile save error:', error);
                }
            }, 500);
        });

        // Auto-save draft as user types
        let saveTimeout;
        const formInputs = document.querySelectorAll('#profile-form input, #profile-form select, #profile-form textarea');
        
        formInputs.forEach(input => {
            input.addEventListener('input', function() {
                clearTimeout(saveTimeout);
                saveTimeout = setTimeout(() => {
                    const draftData = {};
                    formInputs.forEach(inp => {
                        if (inp.value) draftData[inp.name] = inp.value;
                    });
                    localStorage.setItem('profileDraft', JSON.stringify(draftData));
                }, 2000);
            });
        });

        // Load draft on page load
        window.addEventListener('load', function() {
            const draft = localStorage.getItem('profileDraft');
            if (draft && !ProfileManager.exists()) {
                const draftData = JSON.parse(draft);
                Object.keys(draftData).forEach(key => {
                    const element = document.getElementById(key);
                    if (element && !element.value) {
                        element.value = draftData[key];
                        if (key === 'feedback_complexity') {
                            updateComplexityLabel(draftData[key]);
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>